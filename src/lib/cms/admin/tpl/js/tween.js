// usage: tween(element, property, to, from, duration)
// example: tween(height_div, 'height', 'current', height_div_exp, height_div_t);

var fps=40;var debugging=0;var tw=[];var rand_str=generatePassword();var float_pcre=new RegExp("(\\+|-)?(\\d*\\.)?\\d+",'g');var color_at_end=new RegExp("[Cc]olor$");function tween(a,b,c,d,e){if(arguments.length<5)return false;if(Math.random()>=0.75){for(var i=0;i<tw.length;++i){if(tw[i]["status"]==="playing")break;if(i==tw.length-1){tw=[]}}}var f=tw.length;tw[f]=[];tw[f]["f"]=(Boolean(arguments[5]))?arguments[5]:"linear";tw[f]["ez"]=0;tw[f]["status"]="playing";tw[f]["element"]=resolve_element(a);tw[f]["property"]=resolve_property(b);if(Boolean(tw[f]["property"].match(color_at_end)))tw[f]["is_color_tween"]=true;tw[f]["duration"]=e;tw[f]["step"]=0;tw[f]["interval"]=1000/fps;tw[f]["steps"]=Math.ceil(e/tw[f]["interval"]);tw[f]["from_orig"]=c;tw[f]["to_orig"]=d;tw[f]["timer"]=false;for(var g=0;g<f;++g){if(tw[g]["status"]!=="playing")continue;if(tw[g]["element"]!==tw[f]["element"])continue;if(tw[g]["property"]!==tw[f]["property"])continue;tw[g]["status"]="aborted";clearInterval(tw[g]["timer"])}if(tw[f]["from_orig"]==='current'){tw[f]["from"]=getStyle(tw[f]["element"],tw[f]["property"]);if(tw[f]["from"]===''||tw[f]["from"]==='NaN'||typeof(tw[f]["from"])==="undefined")tw[f]["from"]=tw[f]["element"].style[tw[f]["property"]];if(tw[f]["from"]===''||tw[f]["from"]==='NaN'||typeof(tw[f]["from"])==="undefined"){if(tw[f]["is_color_tween"])tw[f]["from"]="#7F7F7F";else tw[f]["from"]='0'}if(tw[f]["is_color_tween"])tw[f]["from"]=resolve_color(tw[f]["from"])}if(tw[f]["is_color_tween"]){if(tw[f]["from_orig"]==='current');else tw[f]["from"]=resolve_color(tw[f]["from_orig"]);tw[f]["to"]=resolve_color(tw[f]["to_orig"]);tw[f]["change"]=[];tw[f]["change"]["red"]=tw[f]["to"]["red"]-tw[f]["from"]["red"];tw[f]["change"]["green"]=tw[f]["to"]["green"]-tw[f]["from"]["green"];tw[f]["change"]["blue"]=tw[f]["to"]["blue"]-tw[f]["from"]["blue"]}else{if(tw[f]["from_orig"]!==''){if(tw[f]["from_orig"]==='current')tw[f]["from"]=tw[f]["from"].match(float_pcre);else tw[f]["from"]=tw[f]["from_orig"].match(float_pcre);tw[f]["from"]=parseFloat(tw[f]["from"]);tw[f]["to"]=parseFloat(tw[f]["to_orig"].match(float_pcre));tw[f]["change"]=tw[f]["to"]-tw[f]["from"];var h;if(tw[f]["from_orig"]==='current')h=tw[f]["to_orig"];else h=tw[f]["from_orig"];h=h.replace(float_pcre,rand_str);tw[f]["prefix"]=h.slice(0,h.indexOf(rand_str));tw[f]["suffix"]=str_replace(tw[f]["prefix"]+rand_str,'',h)}}if(debugging){var k=new String();var l=['id','tagName','className'];for(var i in tw[f]){k+=i+": ";if(i!=="element"&&typeof(tw[f][i])===typeof(Object())){for(var j in tw[f][i])k+="\n\t"+j+": "+tw[f][i][j]}else if(i==="element"){for(var j=0;j<l.length;j++)k+="\n\t"+l[j]+": "+tw[f][i][l[j]]}else k+=tw[f][i];k+="\n\n"}alert(k)}if(tw[f]["from_orig"]===""){tw[f]["status"]="playing";tw[f]["timer"]=setTimeout("tw["+f+"][\"element\"].style[tw["+f+"][\"property\"]] = tw["+f+"][\"to_orig\"];tw["+f+"][\"status\"] = \"complete\"",tw[f]["duration"])}else ease(f);return f}function ease(a){if(tw[a]["step"]===0){tw[a]["status"]="playing";if(tw[a]["is_color_tween"])tw[a]["element"].style[tw[a]["property"]]="rgb("+tw[a]["from"]["red"]+","+tw[a]["from"]["green"]+","+tw[a]["from"]["blue"]+")";else tw[a]["element"].style[tw[a]["property"]]=tw[a]["prefix"]+tw[a]["from"]+tw[a]["suffix"]}tw[a]["step"]++;if(tw[a]["step"]<=tw[a]["steps"]&&tw[a]["step"]!==0&&tw[a]["status"]==='playing'){if(tw[a]["is_color_tween"]){var b=parseInt(eval(tw[a]["f"])(tw[a]["step"],parseInt(tw[a]["from"]["red"]),parseInt(tw[a]["change"]["red"]),tw[a]["steps"]));var c=parseInt(eval(tw[a]["f"])(tw[a]["step"],parseInt(tw[a]["from"]["green"]),parseInt(tw[a]["change"]["green"]),tw[a]["steps"]));var d=parseInt(eval(tw[a]["f"])(tw[a]["step"],parseInt(tw[a]["from"]["blue"]),parseInt(tw[a]["change"]["blue"]),tw[a]["steps"]));tw[a]["ez"]="rgb("+b+","+c+","+d+")"}else{tw[a]["ez"]=parseInt(eval(tw[a]["f"])(tw[a]["step"],tw[a]["from"],tw[a]["change"],tw[a]["steps"])*100)/100;tw[a]["ez"]=tw[a]["prefix"]+tw[a]["ez"]+tw[a]["suffix"]}tw[a]["timer"]=setTimeout("ease_repeat("+a+")",tw[a]["interval"])}if(tw[a]["step"]>=tw[a]["steps"]){tw[a]["status"]="complete"}}function ease_repeat(a){try{tw[a]["element"].style[tw[a]["property"]]=tw[a]["ez"];ease(a)}catch(e){}}function h2d(h){return parseInt(h,16)}function str_replace(a,b,c,d){var i=0,j=0,temp='',repl='',sl=0,fl=0,f=[].concat(a),r=[].concat(b),s=c,ra=r instanceof Array,sa=s instanceof Array;s=[].concat(s);if(d)this.window[d]=0;for(i=0,sl=s.length;i<sl;i++){if(s[i]==='')continue;for(j=0,fl=f.length;j<fl;j++){temp=s[i]+'';repl=ra?(r[j]!==undefined?r[j]:''):r[0];s[i]=(temp).split(f[j]).join(repl);if(d&&s[i]!==temp){this.window[d]+=(temp.length-s[i].length)/f[j].length}}}return sa?s:s[0]}function resolve_element(a){if(typeof(a)=="object");else if(typeof(a)=="string")a=document.getElementById(a);if(a.tagName!="undefined")return a;return false}function resolve_property(a){var b;var c=new RegExp("-[a-z]");while(1){if(b=a.match(c)){b=b.toString();a=str_replace(b,b.charAt(1).toUpperCase(),a)}else break}return a}function resolve_color(a){if(a==='transparent')a='#FFF';var r,g,b;var c=new RegExp("^#[0-9a-f]{3}([0-9a-f]{3})?$",'gi');var d=new RegExp("rgb\\(\\s*((?:[0-2]?[0-9])?[0-9])\\s*,\\s*((?:[0-2]?[0-9])?[0-9])\\s*,\\s*((?:[0-2]?[0-9])?[0-9])\\s*\\)$",'gi');if(a.match(c)){if(a.length==4){r=a.charAt(1)+""+a.charAt(1);g=a.charAt(2)+""+a.charAt(2);b=a.charAt(3)+""+a.charAt(3)}else{r=a.charAt(1)+""+a.charAt(2);g=a.charAt(3)+""+a.charAt(4);b=a.charAt(5)+""+a.charAt(6)}r=h2d(r);g=h2d(g);b=h2d(b)}else if(a.match(d)){r=RegExp.$1;g=RegExp.$2;b=RegExp.$3}else return false;var e=[];e['red']=r;e['green']=g;e['blue']=b;return e}function getStyle(c,d){var e="";if(document.defaultView&&document.defaultView.getComputedStyle){e=document.defaultView.getComputedStyle(c,"").getPropertyValue(d)}else if(c.currentStyle){d=d.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()});e=c.currentStyle[d]}return e}function generatePassword(a){a=parseInt(a);if(!a)a=6;var b="";var c="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";var d=c.length;var e;for(i=0;i<a;i++){e=c.charAt(Math.floor(Math.random()*d));b+=e}return b}function substr(a,b,c){a+='';if(b<0){b+=a.length}if(c==undefined){c=a.length}else if(c<0){c+=a.length}else{c+=b}if(c<b){c=b}return a.substring(b,c)}function microtime(a){var b=new Date().getTime()/1000;var s=parseInt(b,10);return(a)?b:(Math.round((b-s)*1000)/1000)+' '+s}function $(){var a=new Array();for(var i=0,len=arguments.length;i<len;i++){var b=arguments[i];if(typeof b=='string'){var c=document.getElementById(b);if(c){a.push(c)}else{var d=(document.all)?document.all:document.getElementsByTagName('*');var e=new RegExp('(^| )'+b+'( |$)');for(var i=0,len=d.length;i<len;i++)if(e.test(d[i].className))a.push(d[i])}if(!a.length)a=document.getElementsByTagName(b);if(!a.length){a=new Array();var d=(document.all)?document.all:document.getElementsByTagName('*');for(var i=0,len=d.length;i<len;i++)if(d[i].getAttribute(b))a.push(d[i])}if(!a.length){var d=(document.all)?document.all:document.getElementsByTagName('*');for(var i=0,len=d.length;i<len;i++)if(d[i].attributes)for(var j=0,lenn=d[i].attributes.length;j<lenn;j++)if(d[i].attributes[j].specified)if(d[i].attributes[j].nodeValue==b)a.push(d[i])}}else{a.push(b)}}if(a.length==1){return a[0]}else{return a}}linear=function(t,b,c,d){return c*t/d+b};easeInBack=function(t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b};easeOutBack=function(t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b};easeInOutBack=function(t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b};easeInCirc=function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b};easeOutCirc=function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b};easeInOutCirc=function(t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b};easeInBounce=function(t,b,c,d){return c-easeOutBounce(d-t,0,c,d)+b};easeOutBounce=function(t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b}else if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+.75)+b}else if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+.9375)+b}else{return c*(7.5625*(t-=(2.625/2.75))*t+.984375)+b}};easeInOutBounce=function(t,b,c,d){if(t<d/2)return easeInBounce(t*2,0,c,d)*.5+b;return easeOutBounce(t*2-d,0,c,d)*.5+c*.5+b};
